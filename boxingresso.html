<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Mapa com Zoom</title>
<style>
  html, body { height: 100%; margin: 0; }
  #wrap { width:100%; height:100vh; touch-action: none; background:#111; }
  #stage { width:100%; height:100%; display:block; background:#222; }
</style>
</head>
<body>
<div id="wrap">
  <!-- Defina o viewBox como a dimensão “natural” do mapa (exemplo 5000x3500) -->
  <svg id="stage" viewBox="0 0 5000 3500" preserveAspectRatio="xMidYMid meet">
    <!-- Se a “imagem” do mapa é um SVG simples, também pode ser usado como href no <image> -->
    <!-- Troque o href para o caminho servido pelo GitHub Pages (não blob): /tsqs/MTS25+MK+MAPA+FINAL+(1).svg -->
    <image id="mapimg" href="MTS25+MK+MAPA+FINAL+(1).svg" x="0" y="0" width="5000" height="3500" />
  </svg>
</div>

<script>
(function(){
  const svg = document.getElementById('stage');
  const vb  = svg.viewBox.baseVal;

  // Limites de zoom: ajuste conforme desejar
  const MAX_IN = 12, MAX_OUT = 0.75;
  const baseW = vb.width, baseH = vb.height;
  const minW = baseW / MAX_IN;
  const maxW = baseW / MAX_OUT;

  let touches = [];
  let prevDist = 0;

  function toSvg(x,y){
    const p = svg.createSVGPoint();
    p.x=x; p.y=y;
    return p.matrixTransform(svg.getScreenCTM().inverse());
  }
  function dist(a,b){ const dx=a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy); }

  svg.addEventListener('pointerdown', e => { svg.setPointerCapture(e.pointerId); touches.push(e); }, {passive:true});

  svg.addEventListener('pointermove', e => {
    const i = touches.findIndex(t => t.pointerId === e.pointerId);
    if (i>=0) touches[i] = e;

    if (touches.length === 2) {
      const p1 = toSvg(touches.clientX, touches.clientY);
      const p2 = toSvg(touches[4].clientX, touches[4].clientY);
      const c  = { x:(p1.x+p2.x)/2, y:(p1.y+p2.y)/2 };
      const d  = dist(p1,p2);

      if (!prevDist) { prevDist = d; return; }

      let s = d / prevDist;
      if (!isFinite(s) || s <= 0) return;

      let newW = vb.width / s;
      newW = Math.min(Math.max(newW, minW), maxW);
      const sApplied = vb.width / newW;
      let newH = vb.height / sApplied;

      vb.x = c.x - newW/2;
      vb.y = c.y - newH/2;
      vb.width = newW;
      vb.height = newH;

      prevDist = d;
    } else if (touches.length === 1) {
      // Pan com delta em coordenadas do SVG
      const prevClientX = e.clientX - e.movementX;
      const prevClientY = e.clientY - e.movementY;
      const a = toSvg(prevClientX, prevClientY);
      const b = toSvg(e.clientX, e.clientY);
      vb.x += (a.x - b.x);
      vb.y += (a.y - b.y);
    }
  }, {passive:true});

  function end(e){
    touches = touches.filter(t => t.pointerId !== e.pointerId);
    if (touches.length < 2) prevDist = 0;
  }
  svg.addEventListener('pointerup', end, {passive:true});
  svg.addEventListener('pointercancel', end, {passive:true});
  svg.addEventListener('pointerleave', end, {passive:true});
})();
</script>
</body>
</html>
